<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a>clam (v1.0.12)</a>
</h1>
<h4>A full Web front end develop envirment.</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.clam">module clam</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.build">
            function <span class="apidocSignatureSpan">clam.</span>build
            <span class="apidocSignatureSpan">(timestamp)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.dataApiHandle">
            function <span class="apidocSignatureSpan">clam.</span>dataApiHandle
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.init">
            function <span class="apidocSignatureSpan">clam.</span>init
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.map">
            function <span class="apidocSignatureSpan">clam.</span>map
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.on">
            function <span class="apidocSignatureSpan">clam.</span>on
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.project">
            function <span class="apidocSignatureSpan">clam.</span>project
            <span class="apidocSignatureSpan">(prj)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">clam.</span>assetUrl</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">clam.</span>assetsTool</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">clam.</span>beautify</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">clam.</span>config</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">clam.</span>hosts</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">clam.</span>jsonHandle</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">clam.</span>map.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">clam.</span>mocker</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">clam.</span>mod</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">clam.</span>page</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">clam.</span>proxy</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">clam.</span>selectfile</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">clam.</span>ssi</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">clam.</span>template</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">clam.</span>walk</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">clam.</span>widget</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.clam.assetUrl">module clam.assetUrl</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.assetUrl.toAbsolutePath">
            function <span class="apidocSignatureSpan">clam.assetUrl.</span>toAbsolutePath
            <span class="apidocSignatureSpan">(pageContent, urlDir)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.clam.assetsTool">module clam.assetsTool</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.assetsTool.clearCacheMod">
            function <span class="apidocSignatureSpan">clam.assetsTool.</span>clearCacheMod
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.assetsTool.feLoader">
            function <span class="apidocSignatureSpan">clam.assetsTool.</span>feLoader
            <span class="apidocSignatureSpan">(data)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.clam.beautify">module clam.beautify</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.beautify.js_beautify">
            function <span class="apidocSignatureSpan">clam.beautify.</span>js_beautify
            <span class="apidocSignatureSpan">(js_source_text, options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.clam.config">module clam.config</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.config.get">
            function <span class="apidocSignatureSpan">clam.config.</span>get
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.config.init">
            function <span class="apidocSignatureSpan">clam.config.</span>init
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.config.on">
            function <span class="apidocSignatureSpan">clam.config.</span>on
            <span class="apidocSignatureSpan">(evtName, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.config.root">
            function <span class="apidocSignatureSpan">clam.config.</span>root
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.config.set">
            function <span class="apidocSignatureSpan">clam.config.</span>set
            <span class="apidocSignatureSpan">(key, config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.clam.dataApiHandle">module clam.dataApiHandle</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.dataApiHandle.dataApiHandle">
            function <span class="apidocSignatureSpan">clam.</span>dataApiHandle
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.dataApiHandle._local">
            function <span class="apidocSignatureSpan">clam.dataApiHandle.</span>_local
            <span class="apidocSignatureSpan">(req, res, next, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.dataApiHandle._remote">
            function <span class="apidocSignatureSpan">clam.dataApiHandle.</span>_remote
            <span class="apidocSignatureSpan">(req, res, next, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.dataApiHandle.handle">
            function <span class="apidocSignatureSpan">clam.dataApiHandle.</span>handle
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.dataApiHandle.httpProxy">
            function <span class="apidocSignatureSpan">clam.dataApiHandle.</span>httpProxy
            <span class="apidocSignatureSpan">(req, res, next, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.dataApiHandle.httpsProxy">
            function <span class="apidocSignatureSpan">clam.dataApiHandle.</span>httpsProxy
            <span class="apidocSignatureSpan">(req, res, next, info)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.dataApiHandle.proxy">
            function <span class="apidocSignatureSpan">clam.dataApiHandle.</span>proxy
            <span class="apidocSignatureSpan">(req, res, next, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.dataApiHandle.socketProxy">
            function <span class="apidocSignatureSpan">clam.dataApiHandle.</span>socketProxy
            <span class="apidocSignatureSpan">(req, res, next, info)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">clam.dataApiHandle.</span>_reFullURI</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">clam.dataApiHandle.</span>remotes</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">clam.dataApiHandle.</span>charset</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.clam.hosts">module clam.hosts</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.hosts.restore">
            function <span class="apidocSignatureSpan">clam.hosts.</span>restore
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.hosts.setHosts">
            function <span class="apidocSignatureSpan">clam.hosts.</span>setHosts
            <span class="apidocSignatureSpan">(pro_hosts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.clam.jsonHandle">module clam.jsonHandle</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.jsonHandle.json">
            function <span class="apidocSignatureSpan">clam.jsonHandle.</span>json
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.clam.map">module clam.map</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.map.map">
            function <span class="apidocSignatureSpan">clam.</span>map
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.clam.map.prototype">module clam.map.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.map.prototype.get">
            function <span class="apidocSignatureSpan">clam.map.prototype.</span>get
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.map.prototype.put">
            function <span class="apidocSignatureSpan">clam.map.prototype.</span>put
            <span class="apidocSignatureSpan">(key, value)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.clam.mocker">module clam.mocker</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.mocker.getMixedMockDate">
            function <span class="apidocSignatureSpan">clam.mocker.</span>getMixedMockDate
            <span class="apidocSignatureSpan">(param, url, isRootPage)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.clam.mod">module clam.mod</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.mod.add">
            function <span class="apidocSignatureSpan">clam.mod.</span>add
            <span class="apidocSignatureSpan">(modName, description, template)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.mod.addCore">
            function <span class="apidocSignatureSpan">clam.mod.</span>addCore
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.mod.del">
            function <span class="apidocSignatureSpan">clam.mod.</span>del
            <span class="apidocSignatureSpan">(data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.mod.list">
            function <span class="apidocSignatureSpan">clam.mod.</span>list
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.clam.page">module clam.page</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.page.add">
            function <span class="apidocSignatureSpan">clam.page.</span>add
            <span class="apidocSignatureSpan">(name, url, description, template)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.page.del">
            function <span class="apidocSignatureSpan">clam.page.</span>del
            <span class="apidocSignatureSpan">(data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.page.list">
            function <span class="apidocSignatureSpan">clam.page.</span>list
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.page.update">
            function <span class="apidocSignatureSpan">clam.page.</span>update
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.clam.project">module clam.project</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.project.project">
            function <span class="apidocSignatureSpan">clam.</span>project
            <span class="apidocSignatureSpan">(prj)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.project.setUrls">
            function <span class="apidocSignatureSpan">clam.project.</span>setUrls
            <span class="apidocSignatureSpan">(urls)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.clam.proxy">module clam.proxy</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.proxy.fetch">
            function <span class="apidocSignatureSpan">clam.proxy.</span>fetch
            <span class="apidocSignatureSpan">(url, host, callback)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.clam.selectfile">module clam.selectfile</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.selectfile.getTree">
            function <span class="apidocSignatureSpan">clam.selectfile.</span>getTree
            <span class="apidocSignatureSpan">(root)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.clam.ssi">module clam.ssi</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.ssi.getHtml">
            function <span class="apidocSignatureSpan">clam.ssi.</span>getHtml
            <span class="apidocSignatureSpan">(res, fullpath)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.clam.template">module clam.template</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.template.convert">
            function <span class="apidocSignatureSpan">clam.template.</span>convert
            <span class="apidocSignatureSpan">(src, dest, param, destName)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.template.init">
            function <span class="apidocSignatureSpan">clam.template.</span>init
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.clam.walk">module clam.walk</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.walk.walk">
            function <span class="apidocSignatureSpan">clam.</span>walk
            <span class="apidocSignatureSpan">(dir, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.walk.rmrf">
            function <span class="apidocSignatureSpan">clam.walk.</span>rmrf
            <span class="apidocSignatureSpan">(dir, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.walk.rmrfSync">
            function <span class="apidocSignatureSpan">clam.walk.</span>rmrfSync
            <span class="apidocSignatureSpan">(dir)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.walk.walkSync">
            function <span class="apidocSignatureSpan">clam.walk.</span>walkSync
            <span class="apidocSignatureSpan">(dir)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.clam.widget">module clam.widget</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.widget.add">
            function <span class="apidocSignatureSpan">clam.widget.</span>add
            <span class="apidocSignatureSpan">(widgetName, description, template)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.widget.del">
            function <span class="apidocSignatureSpan">clam.widget.</span>del
            <span class="apidocSignatureSpan">(data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.clam.widget.list">
            function <span class="apidocSignatureSpan">clam.widget.</span>list
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.clam" id="apidoc.module.clam">module clam</a></h1>


    <h2>
        <a href="#apidoc.element.clam.build" id="apidoc.element.clam.build">
        function <span class="apidocSignatureSpan">clam.</span>build
        <span class="apidocSignatureSpan">(timestamp)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">build = function (timestamp){
    var build = require('./lib/build.js');
    build.build('server', timestamp);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            return;
        }
        var startServer = require('./lib/server.js');
        startServer(false);
    },
    build: function(timestamp){
        var build = require('./lib/build.js');
        build.<span class="apidocCodeKeywordSpan">build</span>('server', timestamp);
    }
}
// clam.on();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.dataApiHandle" id="apidoc.element.clam.dataApiHandle">
        function <span class="apidocSignatureSpan">clam.</span>dataApiHandle
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">dataApiHandle = function () {
    return function (req, res, next) {
        var remotes = exports.remotes;
        // no interfaces defined
        if (!remotes || !remotes.length) {
            next();
            return;
        }
        var url = uri.parse(req.url);
        _.some(remotes, function (options) {
            // equals or matched the option pathname
            if (options.pathname === url.pathname || url.pathname.match(options.pathname)) {
                exports.proxy(req, res, next, options);
                return true;
            }
        }) || next();
    };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.init" id="apidoc.element.clam.init">
        function <span class="apidocSignatureSpan">clam.</span>init
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function (){
    config.init();
    template.init();
    var ret = project({});

    ret.data.forEach(function (ac) {
        debug(ac.action, ac.content);
    });
    process.exit(0);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var template = require('./lib/template.js');
var mod = require('./lib/mod.js');
var page = require('./lib/page.js');
var widget = require('./lib/widget.js');

var clam = module.exports = {
    init: function(){
config.<span class="apidocCodeKeywordSpan">init</span>();
template.init();
var ret = project({});

ret.data.forEach(function (ac) {
    debug(ac.action, ac.content);
});
process.exit(0);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.map" id="apidoc.element.clam.map">
        function <span class="apidocSignatureSpan">clam.</span>map
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Map() {
    if (!this instanceof Map) {
        return new Map();
    }
    this._cache = {};
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    return;
}
//è¿”å›žæ•°ç»„ï¼Œè¡¨ç¤ºæ˜¯ç›®å½•ï¼Œéœ€è¦æ˜¾ç¤ºç›®å½•ã€‚
if(util.isArray(realPageRelativePath)){
    var files = realPageRelativePath.sort();
    debug('files', util.inspect(files));
    var tplPath = path.join(__dirname, conf.templateDir, conf.template);
    _.<span class="apidocCodeKeywordSpan">map</span>(files, function(file){
        file.path = path.join(url, file.name);
        return file;
    })
    // this is using juicer engine only
    var pageContent = J(fs.readFileSync(tplPath).toString(), {folder : url, back: join(url, '..').replace(/\\/g, '
;/'), folderInfo:files});
    // this is using an include render and juicer
    // var pageContent = J(compile.render(tplPath, [modsDir], prjInfo.cdnPath), {folderInfo: files});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.on" id="apidoc.element.clam.on">
        function <span class="apidocSignatureSpan">clam.</span>on
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">on = function (){
    var prjInfo = config.get('project');
    if (!prjInfo) {
        console.log('Execute "clam init".');
        return;
    }
    var startServer = require('./lib/server.js');
    startServer(false);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        startServer(false);
    },
    build: function(timestamp){
        var build = require('./lib/build.js');
        build.build('server', timestamp);
    }
}
// clam.<span class="apidocCodeKeywordSpan">on</span>();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.project" id="apidoc.element.clam.project">
        function <span class="apidocSignatureSpan">clam.</span>project
        <span class="apidocSignatureSpan">(prj)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">project = function (prj) {
  prjDir = config.root();
  debug('é¡¹ç›®ç›®å½•:%s', prjDir);
  var state = prjState(prjDir);
  debug('é¡¹ç›®çŠ¶æ€:%s', state);
  if (!prj) {
    var info = getProject(prjDir, state);
    return info;
  }

  var actions = [];
  if (state !== 'normal') {
    if (state === 'blank') {
      var pagesFullDir = path.join(prjDir, initConf.pagesDir);
      mkdirp.sync(pagesFullDir);
      actions.push({action: 'åˆ›å»ºé¡µé¢ç›®å½•', content: pagesFullDir});

      var modsFullDir = path.join(prjDir, initConf.modsDir);
      mkdirp.sync(modsFullDir);
      actions.push({action: 'åˆ›å»ºæ¨¡å—ç›®å½•', content: modsFullDir});

      var widgetsFullDir = path.join(prjDir, initConf.widgetsDir)
      mkdirp.sync(widgetsFullDir);
      actions.push({action: 'åˆ›å»ºç»„ä»¶ç›®å½•', content: widgetsFullDir});

      var buildFullDir = path.join(prjDir, initConf.buildDir);
      mkdirp.sync(buildFullDir);
      actions.push({action: 'åˆ›å»ºæž„å»ºç›®å½•', content: buildFullDir});

      var testsFullDir = path.join(prjDir, initConf.testsDir);
      mkdirp.sync(testsFullDir);
      actions.push({action: 'åˆ›å»ºæµ‹è¯•ç›®å½•', content: testsFullDir});
    }
    prj = initConf;
    var dirs = prjDir.split(path.sep);
    prj.name = dirs[dirs.length - 1];
  }


  var oldPrj = config.get('project') || prj;
  if (oldPrj.hosts &amp;&amp; prj.hosts &amp;&amp; oldPrj.hosts !== prj.hosts) {
    hostSwitch.setHosts(prj.hosts);
    actions.push({action: 'æ›´æ–°hostsæ–‡ä»¶', content: 'æ“ä½œç³»ç»Ÿhostsæ–‡ä»¶'});
  }
  for (var k in prj) {
    oldPrj[k] = prj[k];
  }

  config.set('project', oldPrj);
  actions.push({action: 'æ›´æ–°é¡¹ç›®å…ƒæ–‡ä»¶', content: '.clam/project.json'});

  //getMuiConfig();
  //actions.push({action: 'æ›´æ–°é¡¹ç›®gconfigæ–‡ä»¶', content: '.clam/gconfig.json'});

  return {
    succeed: true,
    msg: 'æ›´æ–°é¡¹ç›®ä¿¡æ¯',
    data: actions
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


































</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.clam.assetUrl" id="apidoc.module.clam.assetUrl">module clam.assetUrl</a></h1>


    <h2>
        <a href="#apidoc.element.clam.assetUrl.toAbsolutePath" id="apidoc.element.clam.assetUrl.toAbsolutePath">
        function <span class="apidocSignatureSpan">clam.assetUrl.</span>toAbsolutePath
        <span class="apidocSignatureSpan">(pageContent, urlDir)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function toAbsolutePath(pageContent, urlDir) {
    var cdnPath = config.get('project').cdnPath;

    //å¤„ç†æ¨¡å—ä¸­èµ„æºå¼•ç”¨
    var localHosts = localhosts();
    debug('æœ¬åœ°hoståˆ—è¡¨[%s]', localHosts);

<span class="apidocCodeCommentSpan">    /*/æŠ½å–cdnåŸŸå
    var cdnHost = cdnPath.match(cdnPathReg);
    if (cdnHost) {
        cdnHost = cdnHost[0];
    }
    else {
        cdnHost = '';
    }*/
</span>
    //ä»¥httpå¼€å¤´çš„å°±æ”¹å˜cndPathä¸­çš„ç«¯å£å·
    var port = config.get('project').port;
    var cdnPathWithPort = cdnPath;
    if (cdnPath.indexOf('http') === 0) {
        //å¦‚æžœæ˜¯é¢„è§ˆæœåŠ¡å™¨è¿è¡Œåœ¨80ç«¯å£ï¼Œå°±ä¸æ›´æ”¹
        if (!port || port == 80) {
            port = '';
        }
        else {
            port = ':' + port;
        }
        var matchResult = cdnPath.match(/(http:\/\/[\w\.]+?)(\/.*)/);
        if (matchResult) {
            cdnPathWithPort = matchResult[1] + port + matchResult[2];
        }
    }

    var resourceRootDir = '';
    debug('èµ„æºè·Ÿè·¯å¾„%s', resourceRootDir);
    //debug('å¤„ç†å‰å†…å®¹%s', pageContent);
    //å¤„ç†å¸¦åŸŸåçš„é“¾æŽ¥ã€‚1ã€å¢žåŠ&nbsp;ç«¯å£å·ã€‚2ã€å¢žåŠ&nbsp;æ—¶é—´æˆ³è·¯å¾„
    localHosts.forEach(function(localHost){
        localHost = localHost.replace(/\./g, '\\.');
        var scriptWithDomain = new RegExp('&lt;script[^&gt;]*? src=[\'"](?:http[s]?:\\/\\/)(' + localHost + ')(.*)[\'"][^&gt;]*?&gt;', 'g');
        pageContent = pageContent.replace(scriptWithDomain, function ($1, $2) {
            return $1.replace($2, $2 + port);
        });
    });

    localHosts.forEach(function(localHost){
        localHost = localHost.replace(/\./g, '\\.');
        var styleWithDomain = new RegExp('&lt;link[^&gt;]*? href=[\'"](?:http[s]?:\\/\\/)(' + localHost + ')(.*)[\'"][^&gt;]*?&gt;', 'g');
        pageContent = pageContent.replace(styleWithDomain, function ($1, $2) {
            return $1.replace($2, $2 + port);
        });
    });
    //æ›¿æ¢èµ„æºç›¸å¯¹è·¯å¾„åº”ä¸ºå¸¦åŸŸåå’Œç«¯å£å·çš„ç»å¯¹è·¯å¾„ï¼Œæ&nbsp;¹æ®å½“å‰é¡µé¢æ‰€åœ¨ç›¸å¯¹è·¯å¾„è½¬æ¢
    pageContent = pageContent.replace(scriptReg, function ($1, $2, $3) {
        if ($3.match(/^\$\{/)) {
            return $1;
        }
        else {
            var replacedPath = join(resourceRootDir, urlDir, $3).replace(/\\/ig, '/');
            if ($1.match(/clam-moveto/) &amp;&amp; !$1.match(/clam-moveto\s{0,}=\s{0,}["']\s{0,}head\s{0,}["']/) &amp;&amp; !$1.match(/clam-moveto\s{0,}=\s{0,}["']\s{0,}tail\s{0,}["']/)) {
                replacedPath = "$CLAM_VER$/"+replacedPath;
            }
            return $1.replace($3, cdnPathWithPort + '/' + replacedPath).replace(/["'](\s{0,})([^"']*?)(\s{0,})["']/g, function($
1,$2,$3) {
                return '"'+$3+'"';
            });
        }
    });
    pageContent = pageContent.replace(styleReg, function ($1, $2, $3) {
        if ($3.match(/^\$\{/)) {
            return $1;
        }
        else {
            var replacedPath = join(resourceRootDir, urlDir, $3).replace(/\\/ig, '/');
            if ($1.match(/clam-moveto/) &amp;&amp; !$1.match(/clam-moveto\s{0,}=\s{0,}["']\s{0,}head\s{0,}["']/) &amp;&amp; !$1.match(/clam-moveto\s{0,}=\s{0,}["']\s{0,}tail\s{0,}["']/)) {
                console.log(replacedPath)
                replacedPath = "$CLAM_VER$/"+replacedPath;
            }
            return $1.replace($3, cdnPathWithPort + '/' + replacedPath).replace(/["'](\s{0,})([^"']*?)(\s{0,})["']/g, function($
1,$2,$3) {
                return '"'+$3+'"';
            });
        }
    });

    //å¤„ç†ç»å¯¹è·¯å¾„å¼•ç”¨ã€‚ç›´æŽ¥å¢žåŠ&nbsp;åŸŸåå’Œç«¯å£å·
    pageContent = pageContent.replace(absScript, function ($1, $2) {
        return $1.replace($2, cdnPathWithPort + $2);
    });
    pageContent = pageContent.replace(absStyle, function ($1, $2) {
        return $1.replace($2, cdnPathWithPort + $2);
    });
    //debug('å¤„ç†åŽå†…å®¹%s', pageContent);
    return pageContent;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
       pageContent = isUtf8(pageContent) ? pageContent.toString() : iconv.decode(pageContent, 'gbk');
   }

   //èŽ·å–å½“å‰é¡µé¢åˆ°æºä»£ç&nbsp;æ&nbsp;¹ç›®å½•çš„ç›¸å¯¹è·¯å¾„
   var srcRoot = path.join(config.root(), 'src');
   var urlDir = path.relative(srcRoot, path.dirname(page));
   debug('å¼•ç”¨æ–‡ä»¶ç›¸å¯¹è·¯å¾„:%s', urlDir);
   pageContent = assetUrl.<span class="apidocCodeKeywordSpan">toAbsolutePath</span>(pageContent, urlDir);
   return pageContent;
}

/**
* æ··åˆæ¨¡å—å®šä¹‰å’Œå†…å®¹
* æ&nbsp;¹æ®modefsä¸­å®šä¹‰çš„åç§»é‡ï¼Œæ›¿æ¢å†…å®¹ä¿¡æ¯ï¼Œé‡ç»„content
* @param modDefs
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.clam.assetsTool" id="apidoc.module.clam.assetsTool">module clam.assetsTool</a></h1>


    <h2>
        <a href="#apidoc.element.clam.assetsTool.clearCacheMod" id="apidoc.element.clam.assetsTool.clearCacheMod">
        function <span class="apidocSignatureSpan">clam.assetsTool.</span>clearCacheMod
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">clearCacheMod = function () {
    hasLoadMod = {};   // é¡µé¢åˆ·æ–°æ—¶éœ€è¦æ¸…æ¥šè®°å½•çš„æ¨¡å—
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * @returns content
 */
function recoverAssetsTool(content,map){
// å¯¹mapæŽ’åºï¼Œå°†injectStyleå’ŒinjectStyleæŽ’åˆ°æœ€åŽæ‰§è¡Œ
var requireMap = [];
var placeholderMap = [];

assetsTool.<span class="apidocCodeKeywordSpan">clearCacheMod</span>();

map.forEach(function(i) {
    /\$assetsTool.inject(Script|Style).*/g.test(i.express) ?
        placeholderMap.push(i):
        requireMap.push(i);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.assetsTool.feLoader" id="apidoc.element.clam.assetsTool.feLoader">
        function <span class="apidocSignatureSpan">clam.assetsTool.</span>feLoader
        <span class="apidocSignatureSpan">(data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function feLoader(data) {
    var cmd = [];
    data.forEach(function(i){
        cmd.push('{express:' + i['express'] + ', id:"'+ i['id'] + '"}');
    })

    cmd = 'var data = [' + cmd.join(',') + '], ret = [];'
        + 'for (var i = 0, str; i &lt; data.length; i++) {'
        + '    str = data[i]["express"];'
        + '    if (str) {'
        + '        ret.push({'
        + '            express: str,'
        + '            id: data[i]["id"]'
        + '        });'
        + '    }'
        + '}'
        + 'return ret;';

    var fn = new Function('$assetsTool', cmd);
    return fn(new AssetsTool());
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
map.forEach(function(i) {
    /\$assetsTool.inject(Script|Style).*/g.test(i.express) ?
        placeholderMap.push(i):
        requireMap.push(i);
});

map = requireMap.concat(placeholderMap);
var assetsResult = assetsTool.<span class="apidocCodeKeywordSpan">feLoader</span>(map);

function getAssets(id){
    var ret = '';
    assetsResult.forEach(function(i){
        if(i.id == id){
            ret = i.express;
            return;
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.clam.beautify" id="apidoc.module.clam.beautify">module clam.beautify</a></h1>


    <h2>
        <a href="#apidoc.element.clam.beautify.js_beautify" id="apidoc.element.clam.beautify.js_beautify">
        function <span class="apidocSignatureSpan">clam.beautify.</span>js_beautify
        <span class="apidocSignatureSpan">(js_source_text, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function js_beautify(js_source_text, options) {

    var input, output, token_text, last_type, last_text, last_last_text, last_word, flags, flag_store, indent_string;
    var whitespace, wordchar, punct, parser_pos, line_starters, digits;
    var prefix, token_type, do_block_just_closed;
    var wanted_newline, just_added_newline, n_newlines;
    var preindent_string = '';


    // Some interpreters have unexpected results with foo = baz || bar;
    options = options ? options : {};

    var opt_brace_style;

    // compatibility
    if (options.space_after_anon_function !== undefined &amp;&amp; options.jslint_happy === undefined) {
        options.jslint_happy = options.space_after_anon_function;
    }
    if (options.braces_on_own_line !== undefined) { //graceful handling of deprecated option
        opt_brace_style = options.braces_on_own_line ? "expand" : "collapse";
    }
    opt_brace_style = options.brace_style ? options.brace_style : (opt_brace_style ? opt_brace_style : "collapse");


    var opt_indent_size = options.indent_size ? options.indent_size : 4,
        opt_indent_char = options.indent_char ? options.indent_char : ' ',
        opt_preserve_newlines = typeof options.preserve_newlines === 'undefined' ? true : options.preserve_newlines,
        opt_break_chained_methods = typeof options.break_chained_methods === 'undefined' ? false : options.break_chained_methods
,
        opt_max_preserve_newlines = typeof options.max_preserve_newlines === 'undefined' ? false : options.max_preserve_newlines
,
        opt_jslint_happy = options.jslint_happy === 'undefined' ? false : options.jslint_happy,
        opt_keep_array_indentation = typeof options.keep_array_indentation === 'undefined' ? false : options.keep_array_indentation
,
        opt_space_before_conditional = typeof options.space_before_conditional === 'undefined' ? true : options.space_before_conditional
,
        opt_unescape_strings = typeof options.unescape_strings === 'undefined' ? false : options.unescape_strings;

    just_added_newline = false;

    // cache the source's length.
    var input_length = js_source_text.length;

    function trim_output(eat_newlines) {
        eat_newlines = typeof eat_newlines === 'undefined' ? false : eat_newlines;
        while (output.length &amp;&amp; (output[output.length - 1] === ' '
            || output[output.length - 1] === indent_string
            || output[output.length - 1] === preindent_string
            || (eat_newlines &amp;&amp; (output[output.length - 1] === '\n' || output[output.length - 1] === '\r')))) {
            output.pop();
        }
    }

    function trim(s) {
        return s.replace(/^\s\s*|\s\s*$/, '');
    }

    // we could use just string.split, but
    // IE doesn't like returning empty strings
    function split_newlines(s) {
        //return s.split(/\x0d\x0a|\x0a/);

        s = s.replace(/\x0d/g, '');
        var out = [],
            idx = s.indexOf("\n");
        while (idx !== -1) {
            out.push(s.substring(0, idx));
            s = s.substring(idx + 1);
            idx = s.indexOf("\n");
        }
        if (s.length) {
            out.push(s);
        }
        return out;
    }

    function force_newline() {
        var old_keep_array_indentation = opt_keep_array_indentation;
        opt_keep_array_indentation = false;
        print_newline();
        opt_keep_array_indentation = old_keep_array_indentation;
    }

    function print_newline(ignore_repeated, reset_statement_flags) {

        flags.eat_next_space = false;
        if (opt_keep_array_indentation &amp;&amp; is_array(flags.mode)) {
            return;
        }

        ignore_repeated = typeof ignore_repeated === 'undefined' ? true : ignore_repeated;
        reset_statement_flags = typeof reset_statement_flags === 'undefined' ? true : reset_statement_flags;

        if (reset_statement_flags) {
            flags.if_line = false;
            flags.chain_extra_indentation = 0;
        }

        trim_output();

        if (!output.length) {
            return; // no newline on start of file
        }

        if (output[output.length ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.clam.config" id="apidoc.module.clam.config">module clam.config</a></h1>


    <h2>
        <a href="#apidoc.element.clam.config.get" id="apidoc.element.clam.config.get">
        function <span class="apidocSignatureSpan">clam.config.</span>get
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function get(key){
    if(!PRJROOT){
        init();
    }
    return CONFIG[key];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

    ret.data.forEach(function (ac) {
        debug(ac.action, ac.content);
    });
    process.exit(0);
},
on: function(){
    var prjInfo = config.<span class="apidocCodeKeywordSpan">get</span>('project');
    if (!prjInfo) {
        console.log('Execute "clam init".');
        return;
    }
    var startServer = require('./lib/server.js');
    startServer(false);
},
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.config.init" id="apidoc.element.clam.config.init">
        function <span class="apidocSignatureSpan">clam.config.</span>init
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function init() {

    //åªåˆå§‹åŒ–ä¸€æ¬¡
    if (PRJROOT) {
        return;
    }

    //å‘½ä»¤è¡Œä¼&nbsp;å…¥çš„ç›®å½•å‚æ•°åœ¨ä¸åŒè°ƒç”¨æ–¹å¼ä¸‹ä¸‹æ&nbsp;‡ä¸åŒï¼Œå¤„ç†ç›¸å¯¹è·¯å¾„ä¸ºç»å¯¹è·¯å¾„
    var argvs = process.argv;
    var dir = process.cwd();

    //ä»ŽèŽ·å–å‘½ä»¤è¡Œ--rootå‚æ•°
    for (var i = 0; i &lt; argvs.length; i++) {
        if (argvs[i] === '--root' || argvs[i] === '-r') {
            if (i + 1 &lt; argvs.length) {
                dir = argvs[i + 1];
            }
        }
    }
    dir = path.resolve(dir);
    var metaDir = path.join(dir, META.dir);

    //å…¼å®¹windowså’ŒLinuxè·¯å¾„
    while (!fs.existsSync(metaDir) &amp;&amp; metaDir !== '/' + META.dir &amp;&amp; !metaDir.match(/\w{1,1}:\\.clam/)) {
        metaDir = path.join(metaDir, '../..', META.dir);
    }
    PRJROOT = path.join(metaDir, '..');
    if (PRJROOT === '/' || PRJROOT.match(/\w{1,1}:\\$/)) {
        PRJROOT = dir;
    }

    var metaDir = path.join(PRJROOT, META.dir);
    if(!fs.existsSync(metaDir)){
        return;
    }
    var files = fs.readdirSync(metaDir);
    debug('%sç›®å½•ï¼Œæ–‡ä»¶åˆ—è¡¨%s', metaDir, util.inspect(files));

    files.forEach(function (file, i) {
        if (/.+\.json$/.test(file)) {
            readFromFile(file);
            createWatch(file, metaDir);
        }
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var template = require('./lib/template.js');
var mod = require('./lib/mod.js');
var page = require('./lib/page.js');
var widget = require('./lib/widget.js');

var clam = module.exports = {
    init: function(){
config.<span class="apidocCodeKeywordSpan">init</span>();
template.init();
var ret = project({});

ret.data.forEach(function (ac) {
    debug(ac.action, ac.content);
});
process.exit(0);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.config.on" id="apidoc.element.clam.config.on">
        function <span class="apidocSignatureSpan">clam.config.</span>on
        <span class="apidocSignatureSpan">(evtName, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function on(evtName, fn){
    return EVENT.on(evtName, fn);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        startServer(false);
    },
    build: function(timestamp){
        var build = require('./lib/build.js');
        build.build('server', timestamp);
    }
}
// clam.<span class="apidocCodeKeywordSpan">on</span>();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.config.root" id="apidoc.element.clam.config.root">
        function <span class="apidocSignatureSpan">clam.config.</span>root
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function root(){
    if(!PRJROOT){
        init();
    }
    return PRJROOT;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    }
    else {
        pageContent = fs.readFileSync(page);
        pageContent = isUtf8(pageContent) ? pageContent.toString() : iconv.decode(pageContent, 'gbk');
    }

    //èŽ·å–å½“å‰é¡µé¢åˆ°æºä»£ç&nbsp;æ&nbsp;¹ç›®å½•çš„ç›¸å¯¹è·¯å¾„
    var srcRoot = path.join(config.<span class="apidocCodeKeywordSpan">root</span>(), 'src');
    var urlDir = path.relative(srcRoot, path.dirname(page));
    debug('å¼•ç”¨æ–‡ä»¶ç›¸å¯¹è·¯å¾„:%s', urlDir);
    pageContent = assetUrl.toAbsolutePath(pageContent, urlDir);
    return pageContent;
}

/**
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.config.set" id="apidoc.element.clam.config.set">
        function <span class="apidocSignatureSpan">clam.config.</span>set
        <span class="apidocSignatureSpan">(key, config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function set(key, config){
    if(!PRJROOT){
        init();
    }
    var metaDir = path.join(PRJROOT, META.dir);
    debug('ç›®å½•:%s', metaDir);
    var metaFileName = path.join(metaDir, key+'.json');
    CONFIG[key] = config;
    if(!fs.existsSync(metaDir)){
        mkdirp.sync(metaDir);
    }
    var configStr = JSON.stringify(config);
    configStr = beautify(configStr);

    if(!fs.existsSync(metaFileName)){
        debug("åˆ›å»ºé…ç½®æ–‡ä»¶ %s",metaFileName);
        fs.writeFileSync(metaFileName, configStr);
        createWatch(key+'.json', metaDir);
        return;
    }

    fs.writeFileSync(metaFileName, configStr);
    return;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                line_disable(_name);
            });
            lines.push(ip + ' ' + item.join(' ') + split_char);
        }
    });
    lines.push(endTag + split_char);

    hostFile.<span class="apidocCodeKeywordSpan">set</span>(lines.join(''));
};

/**
 * æ¢å¤HOSTå¹¶å­˜å‚¨
 */
var restore = function () {
    var host = hostFile.get();
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.clam.dataApiHandle" id="apidoc.module.clam.dataApiHandle">module clam.dataApiHandle</a></h1>


    <h2>
        <a href="#apidoc.element.clam.dataApiHandle.dataApiHandle" id="apidoc.element.clam.dataApiHandle.dataApiHandle">
        function <span class="apidocSignatureSpan">clam.</span>dataApiHandle
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">dataApiHandle = function () {
    return function (req, res, next) {
        var remotes = exports.remotes;
        // no interfaces defined
        if (!remotes || !remotes.length) {
            next();
            return;
        }
        var url = uri.parse(req.url);
        _.some(remotes, function (options) {
            // equals or matched the option pathname
            if (options.pathname === url.pathname || url.pathname.match(options.pathname)) {
                exports.proxy(req, res, next, options);
                return true;
            }
        }) || next();
    };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.dataApiHandle._local" id="apidoc.element.clam.dataApiHandle._local">
        function <span class="apidocSignatureSpan">clam.dataApiHandle.</span>_local
        <span class="apidocSignatureSpan">(req, res, next, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_local = function (req, res, next, options) {
    fs.stat(options.local, function (err, stats) {
        if (!err &amp;&amp; stats.isFile()) {
            var action = require(options.local);
            if ('function' === typeof action.handle) {
                action.handle(req, res, next, options);
                return;
            }
            try {
                // åå›žçš„æ•°æ®ä¸æ˜¯æ¨¡å—ï¼Œå°±è®¤ä¸ºæ˜¯jsonäº†ã€‚åªå…è®¸ä¸¤ç§ã€‚æŽ¨èç›´æŽ¥è¿”å›žjsonã€‚
                // å¦‚æžœä¼šnodejsã€‚ç›´æŽ¥æ“ä½œæ•°æ®ã€‚æ–¹ä¾¿ã€‚å¿«æ·
                res.setHeader('Content-Type', 'application/json;text/json; charset=' + exports.charset);
                res.write(JSON.stringify(action));
                res.end();
            } catch ( e ) {
                debug('Stringify failed! Data: %o \n\r File: %s', action, options.local);
                res.end(JSON.stringify({
                    "errno": 500,
                    "errmsg": "Stringify failed ! Please check your action file : "+options.local+"! "
                }));
            }
            return;
        }
        if (options.type === 'auto') {
            return exports._remote(req, res, next, options);
        }
        return next();
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
});
  });
}

exports.handle = exports;
exports.proxy = function (req, res, next, options) {
if (options.type === 'auto' || options.type === 'local') {
    exports.<span class="apidocCodeKeywordSpan">_local</span>(req, res, next, options);
}
if (options.type === 'remote') {
    exports._remote(req, res, next, options);
}
};
exports._local = function (req, res, next, options) {
fs.stat(options.local, function (err, stats) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.dataApiHandle._remote" id="apidoc.element.clam.dataApiHandle._remote">
        function <span class="apidocSignatureSpan">clam.dataApiHandle.</span>_remote
        <span class="apidocSignatureSpan">(req, res, next, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_remote = function (req, res, next, options) {
    if (options.remote.agreement === 'http') {
        return exports.httpProxy(req, res, next, options);
    }
    if (options.remote.agreement === 'https') {
        return exports.httpsProxy(req, res, next, options);
    }
    if (options.remote.agreement === 'socket') {
        return exports.socketProxy(req, res, next, options);
    }
    debug('Remote failed; Unknown agreement &lt;%s&gt; ', options.agreement);
    next();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

exports.handle = exports;
exports.proxy = function (req, res, next, options) {
if (options.type === 'auto' || options.type === 'local') {
    exports._local(req, res, next, options);
}
if (options.type === 'remote') {
    exports.<span class="apidocCodeKeywordSpan">_remote</span>(req, res, next, options);
}
};
exports._local = function (req, res, next, options) {
fs.stat(options.local, function (err, stats) {
    if (!err &amp;&amp; stats.isFile()) {
        var action = require(options.local);
        if ('function' === typeof action.handle) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.dataApiHandle.handle" id="apidoc.element.clam.dataApiHandle.handle">
        function <span class="apidocSignatureSpan">clam.dataApiHandle.</span>handle
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">handle = function () {
    return function (req, res, next) {
        var remotes = exports.remotes;
        // no interfaces defined
        if (!remotes || !remotes.length) {
            next();
            return;
        }
        var url = uri.parse(req.url);
        _.some(remotes, function (options) {
            // equals or matched the option pathname
            if (options.pathname === url.pathname || url.pathname.match(options.pathname)) {
                exports.proxy(req, res, next, options);
                return true;
            }
        }) || next();
    };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}
};
exports._local = function (req, res, next, options) {
fs.stat(options.local, function (err, stats) {
    if (!err &amp;&amp; stats.isFile()) {
        var action = require(options.local);
        if ('function' === typeof action.handle) {
            action.<span class="apidocCodeKeywordSpan">handle</span>(req, res, next, options);
            return;
        }
        try {
            // åå›žçš„æ•°æ®ä¸æ˜¯æ¨¡å—ï¼Œå°±è®¤ä¸ºæ˜¯jsonäº†ã€‚åªå…è®¸ä¸¤ç§ã€‚æŽ¨èç›´æŽ¥è¿”å›žjsonã€‚
            // å¦‚æžœä¼šnodejsã€‚ç›´æŽ¥æ“ä½œæ•°æ®ã€‚æ–¹ä¾¿ã€‚å¿«æ·
            res.setHeader('Content-Type', 'application/json;text/json; charset=' + exports.charset);
            res.write(JSON.stringify(action));
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.dataApiHandle.httpProxy" id="apidoc.element.clam.dataApiHandle.httpProxy">
        function <span class="apidocSignatureSpan">clam.dataApiHandle.</span>httpProxy
        <span class="apidocSignatureSpan">(req, res, next, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">httpProxy = function (req, res, next, options) {
    var remote = options.remote;
    var url = uri.parse(req.url);
    var pathname = remote.pathname || url.pathname;
    var querystring = remote.querystring;
    querystring += (url.query ? '&amp;' : '') + (url.query || '');

    var nsreq = http.request({
        host: remote.domain,
        port: remote.port,
        path: pathname + '?' + querystring,
        method: req.method,
        headers: req.headers
    }, function (nsres) {
        res.statusCode = nsres.statusCode;
        // è¿”å›žçš„æ•°æ®ä¸­å¤´ä¿¡æ¯ç¡®ä¿ä¸ºå¯¹æ–¹åé¦ˆæ•°æ®
        var headers = nsres.headers;
        var headerItem;
        var header;
        for (header in headers) {
            headerItem = headers[header];
            res.setHeader(header, headerItem);
        }
        var buffs = [];
        // æ”¶åˆ°æ•°æ®ï¼Œç«‹åˆ»è¿”å›žã€‚
        nsres.on('data', function (chunk) {
            buffs.push(chunk);
        });
        // ç»“æŸåŒæ—¶å…³é—­æ­¤æ¬¡è¿žæŽ¥
        nsres.on('end', function () {
            buff = joinbuffers(buffs);
            //fix 80% situation bom problem.quick and dirty
            if(buff[0] === 239 &amp;&amp; buff[1] === 187 &amp;&amp; buff[2] === 191) {
                buff = buff.slice(3, buff.length);
            }
            var buffChatset = isUtf8(buff) ? 'utf8' : 'gbk';
            if (buffChatset !== exports.charset) {
                buff = iconv.encode(iconv.decode(buff, buffChatset), exports.charset);
            }
            res.write(buff);
            res.end();
        });
    });
    req.on('data', function (chunk) {
       nsreq.write(chunk);
    });
    req.on('end', function () {
       nsreq.end();
    });
    nsreq.on('error', function (e) {
        debug(e);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        return exports._remote(req, res, next, options);
    }
    return next();
});
};
exports._remote = function (req, res, next, options) {
if (options.remote.agreement === 'http') {
    return exports.<span class="apidocCodeKeywordSpan">httpProxy</span>(req, res, next, options);
}
if (options.remote.agreement === 'https') {
    return exports.httpsProxy(req, res, next, options);
}
if (options.remote.agreement === 'socket') {
    return exports.socketProxy(req, res, next, options);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.dataApiHandle.httpsProxy" id="apidoc.element.clam.dataApiHandle.httpsProxy">
        function <span class="apidocSignatureSpan">clam.dataApiHandle.</span>httpsProxy
        <span class="apidocSignatureSpan">(req, res, next, info)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">httpsProxy = function (req, res, next, info) {
    // ?
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    });
};
exports._remote = function (req, res, next, options) {
    if (options.remote.agreement === 'http') {
        return exports.httpProxy(req, res, next, options);
    }
    if (options.remote.agreement === 'https') {
        return exports.<span class="apidocCodeKeywordSpan">httpsProxy</span>(req, res, next, options);
    }
    if (options.remote.agreement === 'socket') {
        return exports.socketProxy(req, res, next, options);
    }
    debug('Remote failed; Unknown agreement &lt;%s&gt; ', options.agreement);
    next();
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.dataApiHandle.proxy" id="apidoc.element.clam.dataApiHandle.proxy">
        function <span class="apidocSignatureSpan">clam.dataApiHandle.</span>proxy
        <span class="apidocSignatureSpan">(req, res, next, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">proxy = function (req, res, next, options) {
    if (options.type === 'auto' || options.type === 'local') {
        exports._local(req, res, next, options);
    }
    if (options.type === 'remote') {
        exports._remote(req, res, next, options);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            next();
            return;
        }
        var url = uri.parse(req.url);
        _.some(remotes, function (options) {
            // equals or matched the option pathname
            if (options.pathname === url.pathname || url.pathname.match(options.pathname)) {
                exports.<span class="apidocCodeKeywordSpan">proxy</span>(req, res, next, options);
                return true;
            }
        }) || next();
    };
};
exports.remotes = [];
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.dataApiHandle.socketProxy" id="apidoc.element.clam.dataApiHandle.socketProxy">
        function <span class="apidocSignatureSpan">clam.dataApiHandle.</span>socketProxy
        <span class="apidocSignatureSpan">(req, res, next, info)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">socketProxy = function (req, res, next, info) {
    // ?
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
if (options.remote.agreement === 'http') {
    return exports.httpProxy(req, res, next, options);
}
if (options.remote.agreement === 'https') {
    return exports.httpsProxy(req, res, next, options);
}
if (options.remote.agreement === 'socket') {
    return exports.<span class="apidocCodeKeywordSpan">socketProxy</span>(req, res, next, options);
}
debug('Remote failed; Unknown agreement &lt;%s&gt; ', options.agreement);
next();
};
exports.charset = prjInfo ? prjInfo.charset[0] : "utf-8";
exports.httpProxy = function (req, res, next, options) {
var remote = options.remote;
...</pre></li>
    </ul>








</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.clam.hosts" id="apidoc.module.clam.hosts">module clam.hosts</a></h1>


    <h2>
        <a href="#apidoc.element.clam.hosts.restore" id="apidoc.element.clam.hosts.restore">
        function <span class="apidocSignatureSpan">clam.hosts.</span>restore
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">restore = function () {
    var host = hostFile.get();
    var areaReg = new RegExp(beginTag+'[\\s\\S]*?'+endTag+'\\r?\\n?', 'g');
    host = host.replace(areaReg, '');
    hostFile.set(host);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            };
        }

    })();
})();

//test
//NodeHostManager.<span class="apidocCodeKeywordSpan">restore</span>();
exports = module.exports = NodeHostManager;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.hosts.setHosts" id="apidoc.element.clam.hosts.setHosts">
        function <span class="apidocSignatureSpan">clam.hosts.</span>setHosts
        <span class="apidocSignatureSpan">(pro_hosts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setHosts = function (pro_hosts) {
    if(_.isString(pro_hosts)){
        pro_hosts = pro_hosts.split(/\n\r?/);
    }
    parse_host();
    lines.push(beginTag + split_char);
    pro_hosts.forEach(function (item, i) {
        var ip ;
        item = item.replace(/^\s+|\s+$/g, '');
        item = item.replace(/\s+/g, ' ');
        item = item.split(' ');
        if (ip_regx.test(item[0]) || ip6_regx.test[item[0]]) {
            ip = item[0];
            item.splice(0,1);
            item.forEach(function (_name, _i) {
                line_disable(_name);
            });
            lines.push(ip + ' ' + item.join(' ') + split_char);
        }
    });
    lines.push(endTag + split_char);

    hostFile.set(lines.join(''));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  var dirs = prjDir.split(path.sep);
  prj.name = dirs[dirs.length - 1];
}


var oldPrj = config.get('project') || prj;
if (oldPrj.hosts &amp;&amp; prj.hosts &amp;&amp; oldPrj.hosts !== prj.hosts) {
  hostSwitch.<span class="apidocCodeKeywordSpan">setHosts</span>(prj.hosts);
  actions.push({action: 'æ›´æ–°hostsæ–‡ä»¶', content: 'æ“ä½œç³»ç»Ÿhostsæ–‡ä»¶'});
}
for (var k in prj) {
  oldPrj[k] = prj[k];
}

config.set('project', oldPrj);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.clam.jsonHandle" id="apidoc.module.clam.jsonHandle">module clam.jsonHandle</a></h1>


    <h2>
        <a href="#apidoc.element.clam.jsonHandle.json" id="apidoc.element.clam.jsonHandle.json">
        function <span class="apidocSignatureSpan">clam.jsonHandle.</span>json
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function jsonHandle() {
    return function (req, res, next) {
        var prjInfo = config.get('project');
        var url = req.url;
        if(url.indexOf('?') != -1){
            url = url.slice(0, url.indexOf('?'));
        }
        var isJson = false;
        var jsonHandles = prjInfo.json;
        if(!jsonHandles || jsonHandles.length === 0){
            next();
            return;
        }
        for(var i = 0; i &lt; jsonHandles.length; i++){
            var map = jsonHandles[i];
            var re = new RegExp(map.url);
            if (url.match(re)) {
                isJson = true;
                if(map.enabled === 'local'){
                    //åˆ°æœ¬åœ°æ‰¾
                    var localFile = path.join(config.root(), '.clam/json', map.local);
                    var localHandle = require(localFile);
                    if(localHandle(req, res)){
                        return;
                    }
                }

                http.get({host:map.remote, port:80, path:req.url},function (resp) {
                    var buffs = [];
                    if (resp.statusCode !== 200) {
                        res.end('File ' + url + ' not found.');
                        return;
                    }
                    resp.on('data', function (chunk) {
                        buffs.push(chunk);
                    });
                    resp.on('end', function () {
                        var buff = joinbuffers(buffs);

                        //fix 80% situation bom problem.quick and dirty
                        if (buff[0] === 239 &amp;&amp; buff[1] === 187 &amp;&amp; buff[2] === 191) {
                            buff = buff.slice(3, buff.length);
                        }
                        res.setHeader("Content-Type", "text/html");
                        res.end(buff);
                    });
                }).on('error', function (e) {
                        debug(e);
                });
                break;
            }
        }
        if(!isJson){
            next();
        }
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var plugBase = require("plug-base");
plugBase.root(basePath ? basePath : "src");
plugBase.config(config_dir);
plugBase
  .use(doji.PACHandle())
  .use(inspector)
  .use(dataApiHandle())
  .use(jsonHandle.<span class="apidocCodeKeywordSpan">json</span>(prjInfo))
  .plug(require("flex-combo"), {filter:{
    '\\/\\$CLAM_VER\\$': ''
  }})
  .plug(require("essi"))
  .listen(port || ports[0] || 80, sport || ports[1] || 443);

var clamApp = plugBase.app;
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.clam.map" id="apidoc.module.clam.map">module clam.map</a></h1>


    <h2>
        <a href="#apidoc.element.clam.map.map" id="apidoc.element.clam.map.map">
        function <span class="apidocSignatureSpan">clam.</span>map
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Map() {
    if (!this instanceof Map) {
        return new Map();
    }
    this._cache = {};
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    return;
}
//è¿”å›žæ•°ç»„ï¼Œè¡¨ç¤ºæ˜¯ç›®å½•ï¼Œéœ€è¦æ˜¾ç¤ºç›®å½•ã€‚
if(util.isArray(realPageRelativePath)){
    var files = realPageRelativePath.sort();
    debug('files', util.inspect(files));
    var tplPath = path.join(__dirname, conf.templateDir, conf.template);
    _.<span class="apidocCodeKeywordSpan">map</span>(files, function(file){
        file.path = path.join(url, file.name);
        return file;
    })
    // this is using juicer engine only
    var pageContent = J(fs.readFileSync(tplPath).toString(), {folder : url, back: join(url, '..').replace(/\\/g, '
;/'), folderInfo:files});
    // this is using an include render and juicer
    // var pageContent = J(compile.render(tplPath, [modsDir], prjInfo.cdnPath), {folderInfo: files});
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.clam.map.prototype" id="apidoc.module.clam.map.prototype">module clam.map.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.clam.map.prototype.get" id="apidoc.element.clam.map.prototype.get">
        function <span class="apidocSignatureSpan">clam.map.prototype.</span>get
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (key) {
    return this._cache[key] || [];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

    ret.data.forEach(function (ac) {
        debug(ac.action, ac.content);
    });
    process.exit(0);
},
on: function(){
    var prjInfo = config.<span class="apidocCodeKeywordSpan">get</span>('project');
    if (!prjInfo) {
        console.log('Execute "clam init".');
        return;
    }
    var startServer = require('./lib/server.js');
    startServer(false);
},
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.map.prototype.put" id="apidoc.element.clam.map.prototype.put">
        function <span class="apidocSignatureSpan">clam.map.prototype.</span>put
        <span class="apidocSignatureSpan">(key, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">put = function (key, value) {
    (!this._cache[key]) &amp;&amp; (this._cache[key] = []);

    if (value instanceof Array) {
        this._cache[key] = this._cache[key].concat(value);
    } else {
        this._cache[key].push(value); // ä¸åšä¿¡æ¯åŽ»é‡
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    var type = getType(m);

    var mods = parser.getMods(m);

    // é»˜è®¤cssæ”¾åˆ°å¤´éƒ¨ï¼Œjsæ”¾åˆ°åº•éƒ¨
    if (!pos) var pos = (type == CSS) ? HEAD : FOOT;

    self.map.<span class="apidocCodeKeywordSpan">put</span>(type + SEP + (pos || HEAD), mods);
});
};
AssetsTool.prototype.injectStyle = function () {
return this._inject(CSS, HEAD);
};
AssetsTool.prototype.injectScript = function (pos) {
return this._inject(JS, pos);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.clam.mocker" id="apidoc.module.clam.mocker">module clam.mocker</a></h1>


    <h2>
        <a href="#apidoc.element.clam.mocker.getMixedMockDate" id="apidoc.element.clam.mocker.getMixedMockDate">
        function <span class="apidocSignatureSpan">clam.mocker.</span>getMixedMockDate
        <span class="apidocSignatureSpan">(param, url, isRootPage)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getMixedMockDate(param, url, isRootPage){
    if(!param){
        param = {};
    }

    if(global){
        for(var prop in global){
            if(param[prop]){
                continue;
            }
            param[prop] = global[prop];
        }
    }
    param['_pageUrl'] = url;
    param['_pageBaseName'] = path.basename(url);
    if(!isRootPage){
        return param;
    }
    if(!ifDatas[url]){
        return param;
    }
    var urlData = ifDatas[url].response;
    if(urlData){
        for(var ifProp in urlData){
            if(param[ifProp]){
                continue;
            }
            param[ifProp] = urlData[ifProp];
        }
    }
    debug('é¡µé¢æœ€ç»ˆå†…å®¹%s',url, util.inspect(param));
    return param;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            param[attrFixed] = pageParam[attr];
            continue;
        }
        param[attr] = pageParam[attr];
    }
}
debug('getMixedMockDate2%s', util.inspect(param));
param = mocker.<span class="apidocCodeKeywordSpan">getMixedMockDate</span>(param, url, (!!rootContent));
debug('çœŸå®žè¿ä½œçš„å‚æ•°%s', util.inspect(param));

try {
    pageContent = J(pageContent, param);
}
catch (e) {
    debug('Juicerå‡ºé”™%s\n å¯¹è±¡:%s', pageContent, util.inspect(param));
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.clam.mod" id="apidoc.module.clam.mod">module clam.mod</a></h1>


    <h2>
        <a href="#apidoc.element.clam.mod.add" id="apidoc.element.clam.mod.add">
        function <span class="apidocSignatureSpan">clam.mod.</span>add
        <span class="apidocSignatureSpan">(modName, description, template)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">add = function (modName, description, template) {
    var prjInfo = prj();
    var actions = [];

    //åªæ”¯æŒå‡&nbsp;ç§æ‰©å±•åï¼Œå¹¶ä¸”é»˜è®¤ä¸€ä¸ªæ¨¡å—å¿…é¡»åœ¨å­ç›®å½•ä¸­
    var modFileName = computeExt(modName);
    if(modFileName.split('/').length === 1){
        var modNameSet = modFileName.replace(/\..*$/, '');
        modFileName = modNameSet + '/' + modFileName;
    }
    debug(modFileName);
    //å¦‚æžœå­˜åœ¨ç›¸åŒæ¨¡å—æŠ¥é”™
    var modFilePath = path.join(conf.root(), prjInfo.modsDir, modFileName);
    if (fs.existsSync(modFilePath)) {
        return {
            succeed: false,
            msg: 'å·²å­˜åœ¨ç›¸åŒçš„æ¨¡å—ï¼Œåˆ›å»ºæ¨¡å—å¤±è´¥ã€‚',
            data: modFilePath
        };;
    }

    //åˆ›å»ºæ¨¡å—HTMLæ–‡ä»¶ç›®å½•
    var modDir = path.join(modFilePath, '..');
    mkdirp.sync(modDir);

    //ä¿®æ”¹ç›®å½•æƒé™ä¸º775
    var modDepsdirs = modFileName.split('/');
    var dir = '', j = 0;
    for(var i = 0; i &lt; modDepsdirs.length-1; i++){
        dir = path.join(conf.root(), prjInfo.modsDir);
        j = 0;
        while(j &lt;= i ){
            dir = path.join(dir, modDepsdirs[j]);
            j++;
        }
        debug('ä¿®æ”¹ç›®å½•æƒé™%s', dir);
        fs.chmodSync(dir,'775');
    }

    //å–å¾—æ¨¡æ¿è·¯å¾„
    if(!template){
        template = 'default';
    }
    var userHome = process.env.HOME || process.env.HOMEPATH;//å…¼å®¹windows
    var templateDir = path.join(userHome, '.clamconfig/templates', template,'mod');
    if(!fs.existsSync(templateDir)){
        return {
            succeed: false,
            msg: 'æ¨¡æ¿'+template+'ä¸å­˜åœ¨',
            data: ''
        };
    }

    //è½¬æ¢æ¨¡æ¿
    var bn = modDepsdirs[modDepsdirs.length-1];
    var baseModName = path.basename(bn, path.extname(bn));
    var modInfo = {
        name: baseModName,
        description: description
    };
    var param = {project: prjInfo, mod: modInfo};
    templateCenter.convert(templateDir, modDir, param, baseModName);

    //è®°å½•æ¨¡å—å…ƒä¿¡æ¯
    var metaInfo = conf.get('mod');
    if(!metaInfo){
        metaInfo = {};
    }

    metaInfo[modFileName.replace(/\.(html)$/,'')] = modInfo;
    conf.set('mod', metaInfo);
    actions.push({action:'æ›´æ–°æ¨¡å—å…ƒä¿¡æ¯', content: '.clam/mod.json'});

    //å®Œæˆåˆ›å»ºåŽæ‰§è¡Œå›žè°ƒ
    return {
        succeed: true,
        msg: 'æ¨¡å—åˆ›å»º',
        data: actions
    };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
});

program
.command('mod &lt;modname&gt; [template]')
.description(helpInfo['mod'][lang])
.action(function (modname, template) {
  debug('exec mod "%s" "%s"', modname, template);
  mod.<span class="apidocCodeKeywordSpan">add</span>(modname, '', template);
  process.exit(0);
});

program
.command('page &lt;pagename&gt; [template]')
.description(helpInfo['page'][lang])
.action(function (pagename, template) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.mod.addCore" id="apidoc.element.clam.mod.addCore">
        function <span class="apidocSignatureSpan">clam.mod.</span>addCore
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">addCore = function (){
    var prjInfo = prj();
    var name = config.coreName;
    //æ·»åŠ&nbsp;æ&nbsp;¸å¿ƒæ¨¡å—
    addMod({
        name:name,
        description:"é¡¹ç›®æ&nbsp;¸å¿ƒæ¨¡å—ï¼ŒåŒ…å«ä¸€äº›ä¸ä¾èµ–ä»»ä½•åº“çš„JSæ–¹æ³•å’Œé¡µå¤´é¡µå°¾ç­‰é€šç”¨æ¨¡å—",
        addjs:true,
        addcss:true,
        jsns:prjInfo.jsns
    },{
        templateDir : config.coreTemplate
    });
    //æ·»åŠ&nbsp;å¤´&lt;head&gt;å†…å®¹æ¨¡å—
    addMod({
        name:name+"/head",
        description:"é¡¹ç›®é¡µé¢headæ&nbsp;‡ç­¾éƒ¨åˆ†å†…å®¹",
        addjs:false,
        addcss:false
    },{
        templateDir : config.headTemplate
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.mod.del" id="apidoc.element.clam.mod.del">
        function <span class="apidocSignatureSpan">clam.mod.</span>del
        <span class="apidocSignatureSpan">(data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">del = function (data) {
    var prjInfo = prj();
    var dirName = path.dirname(data.name);
    var fileName = path.basename(data.name);
    var modDir = path.join(conf.root(), prjInfo.modsDir, dirName);
    var modPath = path.join(conf.root(), prjInfo.modsDir, dirName, fileName+'.'+prjInfo.pageext[0]);
    var actions = [];
    if(!fs.existsSync(modPath)){
        return {
            succeed:false,
            msg:modPath+"æ–‡ä»¶ä¸å­˜åœ¨"
        }
    }
    //åˆ&nbsp;é™¤é¡µé¢æ–‡ä»¶
    fs.unlinkSync(modPath);
    actions.push({action:'åˆ&nbsp;é™¤æ–‡ä»¶', content: modPath});
    //æ£€æŸ¥è¯¥æ–‡ä»¶å¤¹ä¸‹æ˜¯å¦è¿˜æœ‰æ–‡ä»¶ï¼Œå¦‚æžœæ²¡æœ‰çš„è¯å°±åˆ&nbsp;æŽ‰
    var list = fs.readdirSync(modDir);
    list = _.filter(list,function(file){
        return _.any(config.suffix, function(value) {
            return file.lastIndexOf(value) !== -1;
        });
    });
    if(list.length==0){
        walk.rmrfSync(modDir);
        actions.push({action:'åˆ&nbsp;é™¤æ–‡ä»¶ç›®å½•', content: modDir});
    }
    return {succeed:true,
        msg:'åˆ&nbsp;é™¤é¡µé¢',
        data:actions
    };

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.mod.list" id="apidoc.element.clam.mod.list">
        function <span class="apidocSignatureSpan">clam.mod.</span>list
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">list = function () {
    var prjInfo = prj();

    var modsDir = path.join(conf.root(), prjInfo.modsDir);
    var metaFile = path.join(conf.root(), config.metaDir, config.metaFile);
    var modsFiles = walk.walkSync(modsDir);
    modsFiles = _.filter(modsFiles, function(file) {
        return _.any(config.suffix, function(value) {
            // æ”¹ä¸ºç›´æŽ¥ç”¨åŽç¼€ååˆ¤æ–­ï¼Œé˜²æ­¢.vm.swp è¿™ç±»æ–‡ä»¶æ··å…¥
            var fileSuffix = file.match(/.*\/.*\.(\w+)$/)[1];
            return fileSuffix == value;
        });
    });
    //console.log(modsFiles);
    //conf.root() + prjInfo.dir
    var metaInfo = conf.get('mod');

    var info = _.map(modsFiles, function(file) {
        var fileName = file.slice(modsDir.length+1, file.length);
        var modName = file.slice(modsDir.length+1, file.lastIndexOf('.'));
        var description = '';
        if(metaInfo){
            description = metaInfo[modName] ? metaInfo[modName].description : '';
        }

        return {
            name : modName,
            file : fileName,
            description : description
        };
    });
    return {succeed:true,
        msg:'èŽ·å–æ¨¡å—ä¿¡æ¯',
        data:info
    };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.clam.page" id="apidoc.module.clam.page">module clam.page</a></h1>


    <h2>
        <a href="#apidoc.element.clam.page.add" id="apidoc.element.clam.page.add">
        function <span class="apidocSignatureSpan">clam.page.</span>add
        <span class="apidocSignatureSpan">(name, url, description, template)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function add(name, url, description, template) {
    var prjInfo = conf.get('project');
    var root = conf.root();
    var metaFile = path.join(root, config.metaDir, config.metaFile);
    var actions = [];

    var pageFileName = computeExt(name);

<span class="apidocCodeCommentSpan">    /**
     * å¤„ç†å•é¡µé¡µé¢ç›®å½•å’Œå¤šå±‚é¡µé¢ç›®å½•ç»“æž„ï¼Œå•å±‚ç»“æž„çš„éƒ½åŠ&nbsp;ä¸Š
     */
</span>
    var pagePath = path.join(root, prjInfo.pagesDir, pageFileName);

    if (fs.existsSync(pagePath)) {
        return {succeed:false,
            msg:'å­˜åœ¨ç›¸åŒçš„é¡µé¢ï¼Œåˆ›å»ºé¡µé¢å¤±è´¥ã€‚',
            data:pagePath
        };
    }
    console.log("Creating page:"+pagePath);

    //åˆ›å»ºæ¨¡å—HTMLæ–‡ä»¶ç›®å½•
    var pageDir = path.join(pagePath, '..');
    mkdirp.sync(pageDir);

    //ä¿®æ”¹ç›®å½•æƒé™ä¸º775
    var pageDepsdirs = pageFileName.split('/');
    var dir = '', j=0;
    for(var i = 0; i &lt; pageDepsdirs.length-1; i++){
        dir = path.join(conf.root(), prjInfo.pagesDir);
        j   = 0;
        while(j &lt;= i ){
            dir = path.join(dir, pageDepsdirs[j]);
            j++;
        }
        debug('ä¿®æ”¹ç›®å½•æƒé™%s', dir);
        fs.chmodSync(dir,'775');
    }

    //å–å¾—æ¨¡æ¿è·¯å¾„
    if(!template){
        template = 'default';
    }
    var userHome = process.env.HOME || process.env.HOMEPATH;//å…¼å®¹windows
    var templateDir = path.join(userHome, '.clamconfig/templates', template,'page');
    if(!fs.existsSync(templateDir)){
        return {
            succeed: false,
            msg: 'æ¨¡æ¿'+template+'ä¸å­˜åœ¨',
            data: ''
        };
    }

    //è½¬æ¢æ¨¡æ¿
    var bn = pageDepsdirs[pageDepsdirs.length-1];
    var pageName = path.basename(bn, path.extname(bn));
    var pageInfo = {
        name: pageName,
        url: url,
        description: description
    };
    debug('å˜é‡ä¿¡æ¯:%s', util.inspect(pageInfo));
    var param = {project: prjInfo, page: pageInfo};
    templateCenter.convert(templateDir, pageDir, param, pageName);

    actions.push({action:'åˆ›å»ºé¡µé¢', content: pagePath});

    //è®°å½•pageå…ƒä¿¡æ¯
    var metaInfo = conf.get('page');
    if(!metaInfo){
        metaInfo = {};
    }

    metaInfo[pageFileName.replace(/\.(html)$/,'')] = pageInfo;
    conf.set('page', metaInfo);
    actions.push({action:'æ›´æ–°é¡µé¢å…ƒä¿¡æ¯', content: metaFile});

    return {
        succeed: true,
        msg: 'åˆ›å»ºé¡µé¢',
        data: actions
    };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
});

program
.command('mod &lt;modname&gt; [template]')
.description(helpInfo['mod'][lang])
.action(function (modname, template) {
  debug('exec mod "%s" "%s"', modname, template);
  mod.<span class="apidocCodeKeywordSpan">add</span>(modname, '', template);
  process.exit(0);
});

program
.command('page &lt;pagename&gt; [template]')
.description(helpInfo['page'][lang])
.action(function (pagename, template) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.page.del" id="apidoc.element.clam.page.del">
        function <span class="apidocSignatureSpan">clam.page.</span>del
        <span class="apidocSignatureSpan">(data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">del = function (data) {
    var prjInfo = conf.get('project');
    var root = conf.root();
    var dirName = path.dirname(data.name);
    var fileName = path.basename(data.name);
    var pageDir = path.join(root, 'src', dirName);
    var pagePath = path.join(root, 'src', dirName, fileName + '.html');
    var actions = [];
    //åˆ&nbsp;é™¤é¡µé¢æ–‡ä»¶
    fs.unlinkSync(pagePath);
    actions.push({action:'åˆ&nbsp;é™¤é¡µé¢æ–‡ä»¶', content: pagePath});
    //æ£€æŸ¥è¯¥æ–‡ä»¶å¤¹ä¸‹æ˜¯å¦è¿˜æœ‰æ–‡ä»¶ï¼Œå¦‚æžœæ²¡æœ‰çš„è¯å°±åˆ&nbsp;æŽ‰
    var list = fs.readdirSync(pageDir);
    if(list.length==0 &amp;&amp; path.basename(pageDir) != path.basename('src')){
        fs.rmdirSync(pageDir);
        actions.push({action:'åˆ&nbsp;é™¤é¡µé¢æ–‡ä»¶ç›®å½•', content: pagePath});
    }
    return {succeed:true,
        msg:'åˆ&nbsp;é™¤é¡µé¢',
        data:actions
    };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.page.list" id="apidoc.element.clam.page.list">
        function <span class="apidocSignatureSpan">clam.page.</span>list
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">list = function () {
    var prjInfo = conf.get('project');
    var root = conf.root();
    var pageDir = path.join(root, 'src');
    var metaFile = path.join(root, config.metaDir, config.metaFile);
    var pageFiles = walk.walkSync(pageDir);

    //è¿‡æ»¤æŽ‰éžhtmlæ–‡ä»¶
    var filter_page = new RegExp(path.join(root, prjInfo.pagesDir).replace(/\\/g, '/')+".+\\.html$"),
        filter_root = new RegExp(path.join(root, prjInfo.pagesDir+"/..").replace(/\\/g, '/')+"/([^\/]*?)\\.html$");
    pageFiles = _.filter(pageFiles, function (file) {
        if (file.match(filter_page)) {
            return true;
        }
        else {
            return file.match(filter_root) ? true : false;
        }
    });
    debug('é¡µé¢%s', util.inspect(pageFiles));
    pageFiles = pageFiles.sort(function (a, b) {
        return a &lt; b;
    });
    var metaInfo = conf.get('page');
    var info = _.map(pageFiles, function (file) {
        var pageName = file.slice(pageDir.length+1, file.lastIndexOf('.'));
        var pageFileName = file.slice(pageDir.length+1, file.length);
        var description = '';
        var onlineurl = '';
        var pagelib = '';
        if(metaInfo){
            description = metaInfo[pageName] ? metaInfo[pageName].description : '';
            onlineurl = metaInfo[pageName] ? metaInfo[pageName].url : '';
            pagelib = metaInfo[pageName] ? metaInfo[pageName].lib : '';
        }

        return {
            name: pageName,
            file: pageFileName,
            description: description,
            url: onlineurl,
            lib: pagelib,
            fileExt: 'html'
        };
    });
    return {
        succeed:true,
        msg:'èŽ·å–é¡µé¢ä¿¡æ¯',
        data:info
    };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.page.update" id="apidoc.element.clam.page.update">
        function <span class="apidocSignatureSpan">clam.page.</span>update
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">update = function () {

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.clam.project" id="apidoc.module.clam.project">module clam.project</a></h1>


    <h2>
        <a href="#apidoc.element.clam.project.project" id="apidoc.element.clam.project.project">
        function <span class="apidocSignatureSpan">clam.</span>project
        <span class="apidocSignatureSpan">(prj)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">project = function (prj) {
  prjDir = config.root();
  debug('é¡¹ç›®ç›®å½•:%s', prjDir);
  var state = prjState(prjDir);
  debug('é¡¹ç›®çŠ¶æ€:%s', state);
  if (!prj) {
    var info = getProject(prjDir, state);
    return info;
  }

  var actions = [];
  if (state !== 'normal') {
    if (state === 'blank') {
      var pagesFullDir = path.join(prjDir, initConf.pagesDir);
      mkdirp.sync(pagesFullDir);
      actions.push({action: 'åˆ›å»ºé¡µé¢ç›®å½•', content: pagesFullDir});

      var modsFullDir = path.join(prjDir, initConf.modsDir);
      mkdirp.sync(modsFullDir);
      actions.push({action: 'åˆ›å»ºæ¨¡å—ç›®å½•', content: modsFullDir});

      var widgetsFullDir = path.join(prjDir, initConf.widgetsDir)
      mkdirp.sync(widgetsFullDir);
      actions.push({action: 'åˆ›å»ºç»„ä»¶ç›®å½•', content: widgetsFullDir});

      var buildFullDir = path.join(prjDir, initConf.buildDir);
      mkdirp.sync(buildFullDir);
      actions.push({action: 'åˆ›å»ºæž„å»ºç›®å½•', content: buildFullDir});

      var testsFullDir = path.join(prjDir, initConf.testsDir);
      mkdirp.sync(testsFullDir);
      actions.push({action: 'åˆ›å»ºæµ‹è¯•ç›®å½•', content: testsFullDir});
    }
    prj = initConf;
    var dirs = prjDir.split(path.sep);
    prj.name = dirs[dirs.length - 1];
  }


  var oldPrj = config.get('project') || prj;
  if (oldPrj.hosts &amp;&amp; prj.hosts &amp;&amp; oldPrj.hosts !== prj.hosts) {
    hostSwitch.setHosts(prj.hosts);
    actions.push({action: 'æ›´æ–°hostsæ–‡ä»¶', content: 'æ“ä½œç³»ç»Ÿhostsæ–‡ä»¶'});
  }
  for (var k in prj) {
    oldPrj[k] = prj[k];
  }

  config.set('project', oldPrj);
  actions.push({action: 'æ›´æ–°é¡¹ç›®å…ƒæ–‡ä»¶', content: '.clam/project.json'});

  //getMuiConfig();
  //actions.push({action: 'æ›´æ–°é¡¹ç›®gconfigæ–‡ä»¶', content: '.clam/gconfig.json'});

  return {
    succeed: true,
    msg: 'æ›´æ–°é¡¹ç›®ä¿¡æ¯',
    data: actions
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.project.setUrls" id="apidoc.element.clam.project.setUrls">
        function <span class="apidocSignatureSpan">clam.project.</span>setUrls
        <span class="apidocSignatureSpan">(urls)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setUrls = function (urls) {
  if (!urls) {
    return {
      succeed: false,
      msg: 'æ›´æ–°é¡¹ç›®ä¿¡æ¯',
      data: actions
    };
  }
  prjDir = config.root();
  var prj = config.get('project');
  prj.urls = urls;
  config.set('project', prj);
  config.set('project', prj);
  var actions = [];
  actions.push({action: 'æ›´æ–°é¡¹ç›®å…ƒæ–‡ä»¶', content: '.clam/project.json'});
  return {
    succeed: true,
    msg: 'æ›´æ–°é¡¹ç›®ä¿¡æ¯',
    data: actions
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.clam.proxy" id="apidoc.module.clam.proxy">module clam.proxy</a></h1>


    <h2>
        <a href="#apidoc.element.clam.proxy.fetch" id="apidoc.element.clam.proxy.fetch">
        function <span class="apidocSignatureSpan">clam.proxy.</span>fetch
        <span class="apidocSignatureSpan">(url, host, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">fetch = function (url, host, callback) {
    var filteredUrl = url,
        requestOption = {
            path: url,
            host: host,
            port: 80,
            agent: false
        };

    callback = typeof callback == "function" ? callback : function(code){console.log(code);};

    http.get(requestOption, function(resp) {
        var buffs = [];
        if (resp.statusCode !== 200) {
            var headerHost = requestOption.host;
            cosoleResp('Not found', requestOption.host + requestOption.path + ' (host:'+ reset + yellow + headerHost + reset + ')');
            callback('File ' + requestOption.host + requestOption.path + ' not found.', 404);
            return;
        }
        resp.on('data', function(chunk) {
            buffs.push(chunk);
        });
        resp.on('end', function() {
            var buff = joinbuffers(buffs);

            //fix 80% situation bom problem.quick and dirty
            if(buff[0] === 239 &amp;&amp; buff[1] === 187 &amp;&amp; buff[2] === 191) {
                buff = buff.slice(3, buff.length);
            }
            if(isBinFile(filteredUrl)){
                cosoleResp('Remote', requestOption.host + requestOption.path);
                callback(buff, 200);
                return;
            }
            cosoleResp('Remote', requestOption.host + requestOption.path);
            var charset = isUtf8(buff) ? 'utf8' : 'gbk';
            var outputCharset = prjInfo.charset[0];

            callback(adaptCharset(buff, outputCharset, charset), 200);
            return;
        });
    }).on('error',function() {
        callback('404 Error, File not found.', 404);
        return;
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        if(!realPageRelativePath || realPageRelativePath === '') {
if (!prjInfo.hostsMap || !prjInfo.hostsMap[req.headers.host]) {
    res.writeHead(404, { 'Content-Type': 'text/html;charset=utf-8'});
    res.end('404 Error, File not found.');
    return;
}

proxy.<span class="apidocCodeKeywordSpan">fetch</span>(
    req.url,
    prjInfo.hostsMap ? prjInfo.hostsMap[req.headers.host] : '',
    function(content, code) {
        if (code == 200) {
            res.end(isUtf8(content) ? content.toString() : iconv.decode(content, 'gbk'));
        }
        else {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.clam.selectfile" id="apidoc.module.clam.selectfile">module clam.selectfile</a></h1>


    <h2>
        <a href="#apidoc.element.clam.selectfile.getTree" id="apidoc.element.clam.selectfile.getTree">
        function <span class="apidocSignatureSpan">clam.selectfile.</span>getTree
        <span class="apidocSignatureSpan">(root)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getTree(root) {
    var files = [];
    var fileItems;
    curDir = root?root:curDir;

    if (!fs.existsSync(curDir)) {
        throw "Can't find folder";
        return;
    }
    var stat = fs.statSync(curDir);

    if (stat.isDirectory()) {
        fileItems = fs.readdirSync(curDir);
        if(curDir!="/"){
            files.push({
                name : "..",
                path : path.join(curDir, ".."),
                icon : "icon-arrow-up",
                type : "folder"
            });
        }
        _.each(fileItems, function(name) {
            var p = path.join(curDir, name);
            var s = fs.statSync(p);
            var isD = s.isDirectory();
            var icon = isD ? "icon-folder-open" : "icon-file";
            var type = isD ? "folder" : "file";
            if(name.indexOf(".")==0)return;
            files.push({
                name : name,
                path : p,
                icon : icon,
                type : type
            });
        });
    }

    return {
        files:files,
        cur:curDir
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.clam.ssi" id="apidoc.module.clam.ssi">module clam.ssi</a></h1>


    <h2>
        <a href="#apidoc.element.clam.ssi.getHtml" id="apidoc.element.clam.ssi.getHtml">
        function <span class="apidocSignatureSpan">clam.ssi.</span>getHtml
        <span class="apidocSignatureSpan">(res, fullpath)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getHtml = function (res, fullpath) {
    var str = fs.readFileSync(fullpath).toString();
    var regInclude = /&lt;!--#include ".+"--&gt;/gi, regPath = /&lt;!--#include "(.+)"--&gt;/i;
    var matchArr = str.match(regInclude);

    if (matchArr) {
        for (var i = 0; i &lt; matchArr.length; i++) {
            var realpath = path.join(path.dirname(fullpath),matchArr[i].match(regPath)[1]);
            var getHtml = fs.readFileSync(realpath).toString();
            str = str.replace(matchArr[i],getHtml);
        }
    }
    return str;

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.clam.template" id="apidoc.module.clam.template">module clam.template</a></h1>


    <h2>
        <a href="#apidoc.element.clam.template.convert" id="apidoc.element.clam.template.convert">
        function <span class="apidocSignatureSpan">clam.template.</span>convert
        <span class="apidocSignatureSpan">(src, dest, param, destName)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function convert(src, dest, param, destName){
    eachFile(src, function(file){
        var tmplContent = fs.readFileSync(file);

        //æŽ¢æµ‹å¹¶è½¬æ¢æ–‡æœ¬å†…å®¹ç¼–ç&nbsp;
        var utf8 = isUtf8(tmplContent);
        if (utf8) {
            tmplContent = tmplContent.toString();
        }
        else {
            tmplContent = iconv.decode(tmplContent, 'gbk');
        }

        //æ¨¡æ¿å¤„ç†å¼•æ“Ž
        var pageContent = J(tmplContent, param);

        //å¤åˆ¶åˆ°destDirå¹¶ä¸”å¤„ç†ç¼–ç&nbsp;é—®é¢˜
        var dir = path.dirname(file);
        var relative = path.relative(src, dir);
        var destDir = path.join(dest, relative);
        mkdirp.sync(destDir);
        destName = path.basename(destName);
        var destFilePath = path.basename(file).replace(/template(\..*)/, destName+'$1');
        destFilePath = path.join(destDir, destFilePath);
        var c = iconv.encode(pageContent,config.get('project').charset[0]);
        fs.writeFileSync(destFilePath, c);
        fs.chmodSync(destFilePath, "777");
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var bn = modDepsdirs[modDepsdirs.length-1];
var baseModName = path.basename(bn, path.extname(bn));
var modInfo = {
    name: baseModName,
    description: description
};
var param = {project: prjInfo, mod: modInfo};
templateCenter.<span class="apidocCodeKeywordSpan">convert</span>(templateDir, modDir, param, baseModName);

//è®°å½•æ¨¡å—å…ƒä¿¡æ¯
var metaInfo = conf.get('mod');
if(!metaInfo){
    metaInfo = {};
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.template.init" id="apidoc.element.clam.template.init">
        function <span class="apidocSignatureSpan">clam.template.</span>init
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function init(){
    var userHome = process.env.HOME || process.env.HOMEPATH;//å…¼å®¹windows
    var cacheDir = path.join(userHome, '.clamconfig/templates/default');
    if(fs.existsSync(cacheDir)){
        return;
    }
    mkdirp.sync(cacheDir);
    var sourceRoot = path.join(__dirname,'../resource');
    function copyFn(file){
        debug('å¤åˆ¶é»˜è®¤æ¨¡æ¿æ–‡ä»¶%s', path.basename(file));
        var dir = path.dirname(file);
        var relative = path.relative(sourceRoot, dir);
        var destDir = path.join(cacheDir, relative);
        mkdirp.sync(destDir);
        var srcFile = fs.readFileSync(file);
        var destFilePath = path.join(destDir, path.basename(file));
        fs.writeFileSync(destFilePath, srcFile);
    }
    eachFile(sourceRoot, copyFn);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var template = require('./lib/template.js');
var mod = require('./lib/mod.js');
var page = require('./lib/page.js');
var widget = require('./lib/widget.js');

var clam = module.exports = {
    init: function(){
config.<span class="apidocCodeKeywordSpan">init</span>();
template.init();
var ret = project({});

ret.data.forEach(function (ac) {
    debug(ac.action, ac.content);
});
process.exit(0);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.clam.walk" id="apidoc.module.clam.walk">module clam.walk</a></h1>


    <h2>
        <a href="#apidoc.element.clam.walk.walk" id="apidoc.element.clam.walk.walk">
        function <span class="apidocSignatureSpan">clam.</span>walk
        <span class="apidocSignatureSpan">(dir, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">walk = function (dir, done) {
    var results = [];
    fs.readdir(dir, function(err, list) {
        if (err) return done(err);
        var pending = list.length;
        if (!pending) return done(null, results);
        list.forEach(function(file) {
            file = dir + '/' + file;
            fs.stat(file, function(err, stat) {
                if (stat &amp;&amp; stat.isDirectory()) {
                    walk(file, function(err, res) {
                        results = results.concat(res);
                        if (!--pending) done(null, results);
                    });
                } else {
                    results.push(file);
                    if (!--pending) done(null, results);
                }
            });
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.walk.rmrf" id="apidoc.element.clam.walk.rmrf">
        function <span class="apidocSignatureSpan">clam.walk.</span>rmrf
        <span class="apidocSignatureSpan">(dir, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function rmrf(dir, callback) {
    fs.stat(dir, function(err, stats) {
        if (err) {
            return callback(err);
        }

        if (!stats.isDirectory()) {
            return fs.unlink(dir, callback);
        }

        var count = 0;
        fs.readdir(dir, function(err, files) {
            if (err) {
                return callback(err);
            }

            if (files.length &lt; 1) {
                return fs.rmdir(dir, callback);
            }

            files.forEach(function(file) {
                var sub = path.join(dir, file);

                rmrf(sub, function(err) {
                    if (err) {
                        return callback(err);
                    }

                    if (++count == files.length) {
                        fs.rmdir(dir, callback);
                    }
                });
            });
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.walk.rmrfSync" id="apidoc.element.clam.walk.rmrfSync">
        function <span class="apidocSignatureSpan">clam.walk.</span>rmrfSync
        <span class="apidocSignatureSpan">(dir)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function rmrfSync(dir) {
    var stats = fs.statSync(dir);
    if (!stats.isDirectory()) {
        return fs.unlinkSync(dir);
    }
    var count = 0;
    var files = fs.readdirSync(dir);
    if (files.length &lt; 1) {
        return fs.rmdirSync(dir);
    }

    files.forEach(function(file) {
        var sub = path.join(dir, file);

        rmrfSync(sub);
        if (++count == files.length) {
            fs.rmdirSync(dir);
        }
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var list = fs.readdirSync(modDir);
list = _.filter(list,function(file){
    return _.any(config.suffix, function(value) {
        return file.lastIndexOf(value) !== -1;
    });
});
if(list.length==0){
    walk.<span class="apidocCodeKeywordSpan">rmrfSync</span>(modDir);
    actions.push({action:'åˆ&nbsp;é™¤æ–‡ä»¶ç›®å½•', content: modDir});
}
return {succeed:true,
    msg:'åˆ&nbsp;é™¤é¡µé¢',
    data:actions
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.walk.walkSync" id="apidoc.element.clam.walk.walkSync">
        function <span class="apidocSignatureSpan">clam.walk.</span>walkSync
        <span class="apidocSignatureSpan">(dir)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">walkSync = function (dir){
    var results = [];
    var list = fs.readdirSync(dir);

    list.forEach(function(file) {
        file = (dir + '/' + file).replace(/\\/g, '/');
        var stat = fs.statSync(file);
            if (stat &amp;&amp; stat.isDirectory()) {
                results = results.concat(walkSync(file));
            } else {
                results.push(file);
            }
    });
    return results;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

function initFromIF(){
var root = config.root();
var dataPath = path.join(root,'.clam/data');
if(!fs.existsSync(dataPath)){
    return;
}
var files = walker.<span class="apidocCodeKeywordSpan">walkSync</span>(dataPath);

for(var i = 0; i &lt; files.length; i++){
    var file = files[i];
    if(path.extname(file) !== '.js'){
        continue;
    }
    var ifData = require(file);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.clam.widget" id="apidoc.module.clam.widget">module clam.widget</a></h1>


    <h2>
        <a href="#apidoc.element.clam.widget.add" id="apidoc.element.clam.widget.add">
        function <span class="apidocSignatureSpan">clam.widget.</span>add
        <span class="apidocSignatureSpan">(widgetName, description, template)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">add = function (widgetName, description, template) {
    var prjInfo = prj();
    var actions = [];

    //å¦‚æžœå­˜åœ¨ç›¸åŒæ¨¡å—æŠ¥é”™
    var widgetDirPath = path.join(conf.root(), prjInfo.widgetsDir, widgetName);
    if (fs.existsSync(widgetDirPath)) {
        return {
            succeed: false,
            msg: 'å·²å­˜åœ¨ç›¸åŒçš„ç»„ä»¶ï¼Œåˆ›å»ºæ¨¡å—å¤±è´¥ã€‚',
            data: widgetDirPath
        };
    }

    //åˆ›å»ºæ¨¡å—HTMLæ–‡ä»¶ç›®å½•
    mkdirp.sync(widgetDirPath);

    //ä¿®æ”¹ç›®å½•æƒé™ä¸º775
    var widgetDepsdirs = widgetName.split('/');
    var dir = '', j = 0;
    for(var i = 0; i &lt; widgetDepsdirs.length-1; i++){
        dir = path.join(conf.root(), prjInfo.widgetsDir);
        j = 0;
        while(j &lt;= i ){
            dir = path.join(dir, widgetDepsdirs[j]);
            j++;
        }
        debug('ä¿®æ”¹ç›®å½•æƒé™%s', dir);
        fs.chmodSync(dir,'775');
    }

    //å–å¾—æ¨¡æ¿è·¯å¾„
    if(!template){
        template = 'default';
    }
    var userHome = process.env.HOME || process.env.HOMEPATH;//å…¼å®¹windows
    var templateDir = path.join(userHome, '.clamconfig/templates', template, 'widget');
    if(!fs.existsSync(templateDir)){
        return {
            succeed: false,
            msg: 'æ¨¡æ¿'+template+'ä¸å­˜åœ¨',
            data: ''
        };
    }

    //è½¬æ¢æ¨¡æ¿
    var widgetBaseName = path.basename(widgetName);
    var widgetInfo = {
        name: widgetBaseName,
        description: description
    };
    var param = {project: prjInfo, widget: widgetInfo};
    templateCenter.convert(templateDir, widgetDirPath, param, widgetBaseName);

    //è®°å½•æ¨¡å—å…ƒä¿¡æ¯
    var metaInfo = conf.get('widget');
    if(!metaInfo){
        metaInfo = {};
    }

    metaInfo[widgetName] = widgetInfo;
    conf.set('widget', metaInfo);

    actions.push({action:'æ›´æ–°ç»„ä»¶å…ƒä¿¡æ¯', content: ''});

    //å®Œæˆåˆ›å»ºåŽæ‰§è¡Œå›žè°ƒ
    return {
        succeed: true,
        msg: 'ç»„ä»¶åˆ›å»º',
        data: actions
    };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
});

program
.command('mod &lt;modname&gt; [template]')
.description(helpInfo['mod'][lang])
.action(function (modname, template) {
  debug('exec mod "%s" "%s"', modname, template);
  mod.<span class="apidocCodeKeywordSpan">add</span>(modname, '', template);
  process.exit(0);
});

program
.command('page &lt;pagename&gt; [template]')
.description(helpInfo['page'][lang])
.action(function (pagename, template) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.widget.del" id="apidoc.element.clam.widget.del">
        function <span class="apidocSignatureSpan">clam.widget.</span>del
        <span class="apidocSignatureSpan">(data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">del = function (data) {
    var prjInfo = prj();
    var dirName = data.name;
    var widgetDir = path.join(conf.root(), prjInfo.widgetsDir, dirName);
    var actions = [];
    if(!fs.existsSync(widgetDir)){
        return {
            succeed:false,
            msg:"æ–‡ä»¶ä¸å­˜åœ¨"
        }
    }
    //æ£€æŸ¥è¯¥æ–‡ä»¶å¤¹ä¸‹æ˜¯å¦è¿˜æœ‰æ–‡ä»¶ï¼Œå¦‚æžœæ²¡æœ‰çš„è¯å°±åˆ&nbsp;æŽ‰
    walk.rmrfSync(widgetDir);
    actions.push({action:'åˆ&nbsp;é™¤æ–‡ä»¶ç›®å½•', content: widgetDir});

    return {succeed:true,
        msg:'åˆ&nbsp;é™¤ç»„ä»¶',
        data:actions
    };

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.clam.widget.list" id="apidoc.element.clam.widget.list">
        function <span class="apidocSignatureSpan">clam.widget.</span>list
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">list = function () {
    var prjInfo = prj();

    var widgetsDir = path.join(conf.root(), prjInfo.widgetsDir);
    var metaFile = path.join(conf.root(), config.metaDir, config.metaFile);
    var widgets = fs.readdirSync(widgetsDir);

    //èŽ·å–widgetsç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å¤¹
    widgets = _.filter(widgets, function(file) {
        return fs.statSync(path.join(widgetsDir,file)).isDirectory()
    });

    //console.log(widgets);


    //èŽ·å–ç»„ä»¶å…ƒæ•°æ®
    var metaInfo = {};
    try {
        var metaStr = fs.readFileSync(metaFile);
        metaInfo = JSON.parse(metaStr);
    } catch(e) {
        metaInfo = {};
    }

    //console.log(metaInfo);

    //åˆ†æžç»„ä»¶æ•°æ®
    var info = _.map(widgets, function(widgetName) {
        var description = metaInfo[widgetName] ? metaInfo[widgetName].description : '';
        return {
            name : widgetName,
            description : description
        };
    });


    return {succeed:true,
        msg:'èŽ·å–æ¨¡å—ä¿¡æ¯',
        data:info
    };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>